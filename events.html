<!DOCTYPE html>
<html lang="en" ng-app="appEvents">
<head>
    <meta charset="UTF-8">
    <title>Events</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <script>
        if (!Element.prototype.matches) {
            Element.prototype.matches = Element.prototype.msMatchesSelector ||
                Element.prototype.webkitMatchesSelector;
        }

        if (!Element.prototype.closest) {
            Element.prototype.closest = function (s) {
                let el = this;
                if (!document.documentElement.contains(el)) return null;
                do {
                    if (el.matches(s)) return el;
                    el = el.parentElement || el.parentNode;
                } while (el !== null && el.nodeType === 1);
                return null;
            };
        }

        if (!Array.prototype.forEach) {
            Array.prototype.forEach = function (fn, scope) {
                for (var i = 0, len = this.length; i < len; ++i) {
                    fn.call(scope, this[i], i, this);
                }
            }
        }
        console.log('closest polyfill');
    </script>
    <style>
        body.lock {
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
            -o-user-select: none;
            -moz-user-select: none;
            cursor: pointer;
        }

        body.lock * {
            cursor: pointer;
        }

        .list {
            padding: 10px;
            background: #e8e8e8;
            border: solid;
            width: 25%;
            display: inline-block;
            margin: 10px;
            vertical-align: top;
        }

        .event {
            border: solid;
            padding: 4px 10px;
            margin: 4px 0;
            width: 100%;
            position: relative;
        }

        .event-card-operation {
            background-color: transparent;
            background-clip: padding-box;
            background-origin: padding-box;
            border-radius: 3px;
            opacity: .8;
            padding: 4px;
            position: absolute;
            right: 2px;
            top: 2px;
            z-index: 40;
            border: none;
        }

        .event-card-operation:hover {
            background: transparent;
            color: #e91e63;
        }

        .cloned {
            position: fixed;
            pointer-events: none;
            background: red;
            transform: rotate(10deg);
        }

        .hdn {
            display: none;
        }

        .active {
            background: #fbef88;
        }

        .disabled {
            background: gray;
            opacity: 0.2;
        }
    </style>
    <script src="./js/events.js"></script>
</head>
<body>
<div ng-controller="eventsController" ng-mouseup="dragEventDestroy($event)" ng-mousemove="dragMove($event)">
    <h1>{{title}}</h1>

    <div data-list="{{list.id}}" ng-repeat="list in lists" class="list">
        <span>{{list.name}}</span>
        <button class="btn btn-secondary btn-sm" ng-click="add($event)">Add event</button>
        <div ng-include="list.addEvent ? tpls.events.add : ''"></div>
        <div data-event="{{event.id}}" class="event draggable" ng-mousedown="dragEventInit($event)" ng-repeat="event in list.events track by $index" ng-include="tpls.events.event"></div>
    </div>

    <ul>
        <li ng-repeat="todo in todos">{{todo.title}}</li>
    </ul>
</div>
</body>
</html>